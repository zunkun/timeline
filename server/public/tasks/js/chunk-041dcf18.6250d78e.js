(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-041dcf18"],{"58db":function(t,e,r){},acca:function(t,e,r){"use strict";r.r(e);var c=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"projects"}},[r("el-row",[r("div",{staticClass:"p-head"},[r("el-button",{attrs:{size:"small",plain:"",type:"success"},on:{click:function(e){t.visible=!0}}},[t._v("新增项目")])],1)]),r("el-row",{staticClass:"project-wrapper",attrs:{gutter:10}},t._l(t.projects,function(e,c){return r("el-col",{key:e.id,staticClass:"project-z",attrs:{span:6}},[r("el-card",{style:{"border-color":e.color},attrs:{shadow:"hover"}},[r("div",{staticClass:"project-title"},[r("router-link",{attrs:{to:{name:"project",params:{id:e.id}}}},[r("span",{staticClass:"project-n"},[t._v(t._s(e.name))])]),r("span",{staticClass:"project-button",on:{click:function(r){return t.edit(e,c)}}},[t._v("编辑")])],1),r("p",[r("span",{staticClass:"project-d"},[t._v(t._s(e.description))])])])],1)}),1),r("el-dialog",{attrs:{title:t.currentProject.title||"项目编辑",visible:t.visible,width:"50%"},on:{"update:visible":function(e){t.visible=e}}},[r("el-form",{ref:"projectform",attrs:{model:t.currentProject,rules:t.rules,"label-width":"80px","label-position":"right",id:"projectform"}},[r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{model:{value:t.currentProject.name,callback:function(e){t.$set(t.currentProject,"name",e)},expression:"currentProject.name"}})],1),r("el-form-item",{attrs:{label:"类别",prop:"type"}},[r("el-select",{attrs:{placeholder:"选择类别"},model:{value:t.currentProject.type,callback:function(e){t.$set(t.currentProject,"type",e)},expression:"currentProject.type"}},t._l(t.$store.state.constants.projectTypes,function(t){return r("el-option",{key:t.type,attrs:{label:t.name,value:t.type}})}),1)],1),r("el-form-item",{attrs:{label:"颜色",prop:"color"}},[r("el-input",{staticClass:"color-i",attrs:{placeholder:"输入颜色"},model:{value:t.currentProject.color,callback:function(e){t.$set(t.currentProject,"color",e)},expression:"currentProject.color"}},[r("template",{slot:"append"},[r("el-color-picker",{staticClass:"color-p",model:{value:t.currentProject.color,callback:function(e){t.$set(t.currentProject,"color",e)},expression:"currentProject.color"}})],1)],2)],1),r("el-form-item",{attrs:{label:"说明",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:3},model:{value:t.currentProject.description,callback:function(e){t.$set(t.currentProject,"description",e)},expression:"currentProject.description"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.currentProject.id?r("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:t.deleteProject}},[t._v("删 除")]):t._e(),r("el-button",{attrs:{size:"small",type:"warning",plain:""},on:{click:function(e){t.visible=!1}}},[t._v("取 消")]),r("el-button",{attrs:{size:"small",type:"success",plain:""},on:{click:t.saveProject}},[t._v("确 定")])],1)],1)],1)},o=[],n=(r("96cf"),r("3b8d")),s=r("f499"),i=r.n(s),a={name:"projects",data:function(){return{baseUrl:"/tasks/api/projects",visible:!1,currentProject:{color:"#cf9236",type:"project"},currentIndex:0,projects:[],rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],color:[{required:!0,message:"输入颜色",trigger:"blur"},{type:"string",pattern:/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,message:"请输入正确的hex颜色值",trigger:"blur"}],description:[{required:!0,message:"请输入项目说明",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}]},page:1,limit:20,count:0}},methods:{newProject:function(){this.currentProject={color:"#cf9236",type:"project"},this.currentIndex=0,this.visible=!1},saveProject:function(){var t=this;this.$refs.projectform.validate(function(e){if(e)return t.currentProject.id?t.updateProject(t.currentProject):t.createProject(t.currentProject)}),this.newProject()},updateProject:function(t){var e="".concat(this.baseUrl,"/").concat(t.id);fetch(e,{method:"PUT",body:i()(t),headers:{"content-type":"application/json"}})},createProject:function(t){var e=this,r="".concat(this.baseUrl,"/");fetch(r,{method:"POST",body:i()(t),headers:{"content-type":"application/json"}}).then(function(){var t=Object(n["a"])(regeneratorRuntime.mark(function t(r){var c,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!r.ok){t.next=6;break}return t.next=3,r.json();case 3:c=t.sent,o=[c],e.projects=o.concat(e.projects);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())},getProjects:function(t){var e=this,r="".concat(this.baseUrl,"/?limit=").concat(this.limit,"&page=").concat(this.page);t&&(r="".concat(r,"&type=").concat(t)),fetch(r).then(function(t){if(t.ok)return t.json();throw"获取项目列表失败"}).then(function(t){t&&(e.count=t.count||0,e.projects=t.rows||[])}).catch(function(t){return console.log(t)})},edit:function(t,e){this.projectIndex=e||0,this.currentProject=t,this.visible=!0},deleteProject:function(){var t=this;if(this.currentProject.id){var e="".concat(this.baseUrl,"/").concat(this.currentProject.id);fetch(e,{method:"DELETE"}).then(function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:r.ok&&(t.projects.splice(t.currentIndex,1),t.newProject());case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}}},created:function(){this.getProjects()}},l=a,u=(r("ed0c"),r("2877")),p=Object(u["a"])(l,c,o,!1,null,null,null);e["default"]=p.exports},ed0c:function(t,e,r){"use strict";var c=r("58db"),o=r.n(c);o.a}}]);
//# sourceMappingURL=chunk-041dcf18.6250d78e.js.map