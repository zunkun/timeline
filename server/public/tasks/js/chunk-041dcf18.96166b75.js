(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-041dcf18"],{"58db":function(e,t,r){},acca:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"projects"}},[r("Header",[r("el-row",[r("el-col",{staticClass:"head-left",attrs:{span:20}},[r("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[r("el-breadcrumb-item",{attrs:{to:{name:"projects",query:{page:1}}}},[e._v("项目")]),r("el-breadcrumb-item",[e._v("项目列表")]),r("el-breadcrumb-item",[e._v("第"+e._s(e.page)+"页")])],1)],1),r("el-col",{staticClass:"head-right",attrs:{span:4}},[r("el-button",{attrs:{size:"small",plain:"",type:"success"},on:{click:function(t){e.visible=!0}}},[e._v("新增项目")])],1)],1)],1),r("el-row",{staticClass:"project-wrapper",attrs:{gutter:10}},e._l(e.projects,function(t,n){return r("el-col",{key:t.id,staticClass:"project-z",attrs:{span:6}},[r("el-card",{style:{"border-color":t.color},attrs:{shadow:"hover"}},[r("div",{staticClass:"project-title"},[r("router-link",{attrs:{to:{name:"project",params:{id:t.id}}}},[r("span",{staticClass:"project-n"},[e._v(e._s(t.name))])]),t.enable?r("span",{staticClass:"project-status"},[r("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("使用")])],1):r("span",{staticClass:"project-status"},[r("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("归档")])],1),r("span",{staticClass:"project-button",on:{click:function(r){return e.edit(t,n)}}},[e._v("编辑")])],1),r("p",[r("span",{staticClass:"project-d"},[e._v(e._s(t.description))])])])],1)}),1),e.count>e.limit?r("el-row",{staticClass:"page-bottom"},[r("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":e.limit,total:e.count},on:{"current-change":e.changePage}})],1):e._e(),r("el-dialog",{attrs:{title:e.currentProject.title||"项目编辑",visible:e.visible,width:"50%"},on:{"update:visible":function(t){e.visible=t}}},[r("el-form",{ref:"projectform",attrs:{model:e.currentProject,rules:e.rules,"label-width":"80px","label-position":"right",id:"projectform"}},[r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{model:{value:e.currentProject.name,callback:function(t){e.$set(e.currentProject,"name",t)},expression:"currentProject.name"}})],1),r("el-form-item",{attrs:{label:"类别",prop:"type"}},[r("el-select",{attrs:{placeholder:"选择类别"},model:{value:e.currentProject.type,callback:function(t){e.$set(e.currentProject,"type",t)},expression:"currentProject.type"}},e._l(this.projectTypes,function(e){return r("el-option",{key:e.type,attrs:{label:e.name,value:e.type}})}),1)],1),r("el-form-item",{attrs:{label:"颜色",prop:"color"}},[r("el-input",{staticClass:"color-i",attrs:{placeholder:"输入颜色"},model:{value:e.currentProject.color,callback:function(t){e.$set(e.currentProject,"color",t)},expression:"currentProject.color"}},[r("template",{slot:"append"},[r("el-color-picker",{staticClass:"color-p",model:{value:e.currentProject.color,callback:function(t){e.$set(e.currentProject,"color",t)},expression:"currentProject.color"}})],1)],2)],1),r("el-form-item",{attrs:{label:"说明",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.currentProject.description,callback:function(t){e.$set(e.currentProject,"description",t)},expression:"currentProject.description"}})],1),r("el-form-item",{attrs:{label:"启用"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.currentProject.enable,callback:function(t){e.$set(e.currentProject,"enable",t)},expression:"currentProject.enable"}})],1)],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.currentProject.id?r("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:e.deleteProject}},[e._v("删 除")]):e._e(),r("el-button",{attrs:{size:"small",type:"warning",plain:""},on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{size:"small",type:"success",plain:""},on:{click:e.saveProject}},[e._v("确 定")])],1)],1)],1)},c=[],a=(r("c5f6"),r("f499")),o=r.n(a),s=r("795b"),i=r.n(s),l=(r("96cf"),r("3b8d")),u=r("0418"),p={name:"projects",components:{Header:u["a"]},data:function(){return{baseUrl:"/tasks/api/projects",visible:!1,projectTypes:[{type:"project",name:"项目"},{type:"work",name:"工作"},{type:"family",name:"家庭"},{type:"life",name:"生活"},{type:"skills",name:"技能"}],currentProject:{color:"#cf9236",type:"project",enable:!0},currentIndex:0,projects:[],rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],color:[{required:!0,message:"输入颜色",trigger:"blur"},{type:"string",pattern:/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,message:"请输入正确的hex颜色值",trigger:"blur"}],description:[{required:!0,message:"请输入项目说明",trigger:"blur"},{min:2,message:"至少个字符",trigger:"blur"}]},page:1,limit:20,count:0}},methods:{newProject:function(){this.currentProject={color:"#cf9236",type:"project",enable:!0},this.visible=!1,this.currentIndex=0},saveProject:function(){var e=this;this.$refs.projectform.validate(function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",i.a.resolve());case 2:if(!e.currentProject.id){t.next=7;break}return t.next=5,e.updateProject(e.currentProject);case 5:t.next=10;break;case 7:return t.next=9,e.createProject(e.currentProject);case 9:e.getProjects();case 10:e.newProject();case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())},updateProject:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r="".concat(this.baseUrl,"/").concat(t.id),e.abrupt("return",fetch(r,{method:"PUT",body:o()(t),headers:{"content-type":"application/json"}}));case 2:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),createProject:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){var r,n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r="".concat(this.baseUrl,"/"),e.abrupt("return",fetch(r,{method:"POST",body:o()(t),headers:{"content-type":"application/json"}}).then(function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){var r,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t.ok){e.next=6;break}return e.next=3,t.json();case 3:r=e.sent,c=[r],n.projects=c.concat(n.projects);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getProjects:function(e){var t=this,r="".concat(this.baseUrl,"/?limit=").concat(this.limit,"&page=").concat(this.page);e&&(r="".concat(r,"&type=").concat(e)),fetch(r).then(function(e){if(e.ok)return e.json();throw"获取项目列表失败"}).then(function(e){e&&(t.count=e.count||0,t.projects=e.rows||[])})},edit:function(e,t){this.projectIndex=t||0,this.currentProject=e,this.visible=!0},deleteProject:function(){var e=this;if(this.currentProject.id){var t="".concat(this.baseUrl,"/").concat(this.currentProject.id);fetch(t,{method:"DELETE"}).then(function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:r.ok&&(e.projects.splice(e.currentIndex,1),e.newProject());case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},changePage:function(e){this.page=e,this.$router.push({query:{page:e}})}},created:function(){var e=this.$route.query;this.page=Number(e.page)||1,this.limit=Number(e.limit)||20,this.type=Number(e.type)||"",this.getProjects()},watch:{$route:function(e,t){e.query.page!==t.params.page&&(this.page=Number(e.query.page)||1,this.getProjects())}}},m=p,d=(r("ed0c"),r("2877")),f=Object(d["a"])(m,n,c,!1,null,null,null);t["default"]=f.exports},ed0c:function(e,t,r){"use strict";var n=r("58db"),c=r.n(n);c.a}}]);
//# sourceMappingURL=chunk-041dcf18.96166b75.js.map